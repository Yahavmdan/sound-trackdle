<div class="h-50px position-fixed">
  <div class="w-50px h-50px d-flex justify-content-center align-items-center">
    <i [ngClass]="isDarkMode ? 'bi-brightness-low-fill f-36' : 'bi-moon-fill f-28'"
       (click)="toggleMode()"
       class="bi"></i>
  </div>
</div>
<div @fade @glide class="d-flex flex-column align-items-center w-100">
  <i class="bi bi-file-earmark-music-fill f-80 mt-5"></i>
  <div class="f-24 f-sm-16 fw-700 col-6 text-center my-2">Sound Trackdle</div>
  <i (click)="isGuide = !isGuide" class="bi bi-info-circle text-blue my-1 pointer"></i>
  <p *ngIf="isGuide" @fade @glide class="col-10 col-sm-5 text-center f-14 f-sm-12 text-blue">Every day a different soundtrack from a movie will be provided,
  you need to guess what is the movie this soundtrack is from. you have 3 guesses. for each failure you'll be given a hint.</p>
  <div class="d-flex flex-wrap col-12 col-sm-6 col-md-4 justify-content-center">
    <div @fade @glide *ngFor="let hint of hints;" class="d-flex align-items-center">
      <i class="f-12 bi bi-lightbulb-fill text-yellow mx-2"></i>
      <span class="f-12 text-center">{{ hint }}</span>
    </div>
  </div>
  <audio @fade *ngIf="audioBlobUrl" class="my-2 col-12 col-sm-5" controls>
    <source [src]="audioBlobUrl" type="audio/mpeg">
  </audio>
  <div @fade *ngIf="isLoading" class="spinner-border" [ngClass]="!isDarkMode ? 'text-dark': 'text-light'" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <div class="text-center" *ngIf="isLost && file.name">No more guesses! the movie was <span class="fw-700 f-20 text-red">{{ file.name + '!' | titlecase }}</span> better luck next time.</div>
  <div class="d-flex justify-content-center col-12">
    <input (focus)="focusInput()"
           class="col-12 col-sm-4"
           placeholder="Guess the movie"
           type="text"
           [matAutocomplete]="auto"
           [formControl]="myControl"
           #input>
    <i class="bi"></i>
  </div>
    <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onMovieSelected($event.option.value, input)">
      <mat-option *ngFor="let movie of filteredOptions | async" [value]="movie.id">
        {{ movie.name }}
      </mat-option>
    </mat-autocomplete>

  <h3 @fade *ngIf="isWin" class="text-green">Wow! good job!</h3>
  <div @fade *ngIf="!isWin && !isLost" class="card-wrapper d-flex col-12 col-sm-3 justify-content-evenly mt-1 mb-3">
    <button class="pointer button-layout bg-yellow hold-button"
            [class.holding]="isHolding"
            (mousedown)="startHold(input)"
            (mouseup)="endHold()"
            (mouseleave)="cancelHold()"
            (touchstart)="startHold(input)" (touchmove)="cancelHold()" (touchcancel)="endHold()" (touchend)="cancelHold()"
    >Skip...</button>
    <button class="pointer button-layout bg-green"  [ngClass]="isHolding ? 'col-3' : 'col-5'" (click)="submit(input)">Go!</button>
  </div>
  <button class="button-layout col-6 col-sm-2" [ngClass]="isWin || isLost ? 'ring' : ''" (click)="getRecentFiles()">Play recent challenges</button>
  <div class="d-flex col-sm-5 col-12 flex-wrap card-wrapper my-3 justify-content-center" @fade @glide *ngIf="files">
    <div @fade *ngIf="isRecentLoading" class="spinner-border" [ngClass]="!isDarkMode ? 'text-dark': 'text-light'" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <div class="f-12" *ngIf="!files.length && !isRecentLoading"> No recent challenges</div>
    <div class="m-2" *ngFor="let file of files">
      <div class="pointer" [ngClass]="{'text-decoration-line-through text-blue': file.clicked}" (click)="getFile(file.id, input)">
        <i class="bi bi-film mx-1"></i>
        <i class="f-14 mx-1">{{ file.played_at }}</i>
      </div>
    </div>
  </div>
</div>
<button class="action-btn" *ngIf="!isAdmin" (click)="isForm = !isForm">login</button>
<button class="action-btn" *ngIf="isAdmin" (click)="logout()">logout</button>
<form *ngIf="isForm" class="d-flex">
  <title>Login</title>
  <p>user name</p>
  <input class="h-50" #username>
  <p>password</p>
  <input class="h-50" #password type="password">
  <button class="h-50" (click)="login(username.value, password.value)" type="button">submit</button>
</form>
<form *ngIf="isAdmin" class="px-4 d-flex flex-column h-100 justify-content-center" >
  <input type="file" (change)="onFileSelected($event)" accept=".mp3">
  <button (click)="onSubmit()" type="button">Upload</button>
</form>
<div *ngIf="isWin" [ngClass]="isWin ? 'many-confetti' : ''">
  <div class="confetti"></div><div class="confetti"></div><div class="confetti"></div><div class="confetti"></div>
  <div class="confetti"></div><div class="confetti"></div><div class="confetti"></div><div class="confetti"></div>
  <div class="confetti"></div>
</div>
